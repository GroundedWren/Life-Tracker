<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Track life in two-player games">
	<title>Life Tracker</title>

	<script>
		/**
		 * A script for a loading veil
		 * @author Vera Konigin vera@groundedwren.com
		 * https://groundedwren.neocities.org
		 */
		window.GW = window.GW || {};
		window.GW.Controls = window.GW.Controls || {};
		(function Veil(ns) {
			ns.DeferKeys = {"DOMContentLoaded": true};
			
			/**
			 * Defers the lowering of the veil until a key is cleared
			 * @param {string} key The defer key to keep the veil up
			 */
			ns.addDefer = function addDefer(key) {
				ns.DeferKeys[key] = true;
			}
			
			/**
			 * Marks a defer key as complete and clears the veil if no remain
			 * @param {string} key The key to clear
			 */
			ns.clearDefer = function clearDefer(key) {
				delete ns.DeferKeys[key];
				if(Object.keys(ns.DeferKeys).length === 0) {
					requestAnimationFrame(() => document.getElementById("styGwLoad")?.remove());
				}
			}
			
			document.head.insertAdjacentHTML("beforeend", `
				<style id="styGwLoad">
					body {
						opacity: 0;
					}
					html {
						width: 100vw;
						height: 100vh;
						background-color: var(--veil-light-color, #E3E3E3) !important;
					}
					@media(prefers-color-scheme: dark) {
						html {
							background-color: var(--veil-dark-color, #242424) !important;
						}
					}
				</style>
			`);
			window.addEventListener("DOMContentLoaded", function onDOMContentLoadedVeil() {
				ns.clearDefer("DOMContentLoaded");
				setTimeout(() => document.getElementById("styGwLoad")?.remove(), 3000);
			});
		}) (window.GW.Controls.Veil = window.GW.Controls.Veil || {});
	</script>

	<link href="./Styles/Variables.css" rel="stylesheet" type="text/css">
	<link href="./Styles/Main.css" rel="stylesheet" type="text/css">

	<script src="./Scripts/SVGIconControl.js"></script>
	<script src="./Scripts/SwitchControl.js"></script>
	<script src="./Scripts/ProgressRingControl.js"></script>
	<link href="./Styles/InfoDialog.css" rel="stylesheet" type="text/css">
	<link href="./Styles/InputGrid.css" rel="stylesheet" type="text/css">
	
	<script src="./Scripts/PlayerLifeControl.js"></script>
	<script src="./Scripts/LifeTracker.js"></script>

	<style>
		html, body {
			max-width: initial;
			margin-inline: 0;
			height: 100vh;
		}

		body {
			--header-width: 44px;

			position: relative;
			display: grid;
			grid-template-rows: 1fr calc(var(--header-width) / 2) calc(var(--header-width) / 2) 1fr;
			grid-template-columns: auto;

			header {
				grid-row: 2 / 4;
				grid-column: 1;
				z-index: 2;
			}

			section {
				display: grid;
				justify-items: center;
				padding-block-start: calc(var(--header-width) / 2);
			}

			#secPlayerTop {
				grid-row: 1 / 3;
				grid-column: 1;

				transform: rotate(180deg);

				background-color: powderblue;
			}

			#secPlayerBottom {
				grid-row: 3 / 5;
				grid-column: 1;

				background-color: thistle;
			}
		}

		header {
			display: grid;
			grid-template-columns: 1fr minmax(auto, 1.75fr) 1fr;
			grid-template-rows: 44px;
			margin-inline: 20px;

			button {
				min-width: 44px;
				display: grid;
				border-radius: 100%;

				.gw-icon {
					width: 30px;
					height: 30px;
				}

				&:first-of-type {
					justify-self: start;
				}
				&:last-of-type {
					justify-self: end;
				}
			}

			#centerButtons {
				display: flex;
				flex-direction: row;
				gap: 5px;
				justify-content: space-between;

				grid-column: 2 / 3;
			}
		}

		button:not(.default-style) {
			--btn-color: lightcyan;
			background-color: color-mix(in oklab, var(--btn-color), transparent var(--btn-transparency, 0%)) !important;
			border: none !important;

			&:not([disabled]) {
				&:hover {
					--btn-color: lightsteelblue;
				}

				&:active {
					--btn-color: lightskyblue;
				}
			}
		}

		dialog {
			h1 {
				background-color: var(--accent-color);
				text-align: center;
			}
		}

		#diaNew {
			.input-grid {
				margin-block: 10px;

				input {
					font-size: 1.5em;
					line-height: 44px;
				}
			}

			.quick-buttons, footer {
				display: grid;
				grid-template-columns: 1fr 1fr;
				grid-template-rows: 44px;
			}
		}

		#diaHistory {
			th {
				padding-inline: 2px;
			}
			tbody tr {
				height: 44px !important;

				text-align: center;
			}

			footer {
				display: grid;
				grid-template-rows: 44px;
			}
		}

		.info {
			figure {
				display: grid;
				grid-template-rows: auto auto;
				justify-items: center;
				text-align: center;
			}
		}
	</style>
</head>
<body>
	<header>
		<button onclick="document.getElementById('diaInfo').showModal()">
			<gw-icon iconKey="circle-info" name="Info"></gw-icon>
		</button>
		<div id="centerButtons">
			<button id="btnUndo" onclick="GW.LifeTracker.undo()" disabled>
				<gw-icon iconKey="backward-step" name="Undo"></gw-icon>
			</button>
			<button onclick="document.getElementById('diaNew').showModal()">
				<gw-icon iconKey="star-of-life" name="New"></gw-icon>
			</button>
			<button id="btnRedo" onclick="GW.LifeTracker.redo()" disabled>
				<gw-icon iconKey="forward-step" name="Redo"></gw-icon>
			</button>
		</div>
		<button onclick="GW.LifeTracker.showHistory()">
			<gw-icon iconKey="scroll" name="History"></gw-icon>
		</button>
	</header>
	<section id="secPlayerTop" aria-labelledby="spnTopPlayerLbl">
		<gw-player-life id="plTop" key="Top"></gw-player-life>
	</section>
	<section id="secPlayerBottom" aria-labelledby="spnBottomPlayerLbl">
		<gw-player-life id="plBottom" key="Bottom"></gw-player-life>
	</section>
	<dialog id="diaNew" aria-labelledby="hNew">
		<form aria-labelledby="hNew" onsubmit="GW.LifeTracker.onNewSubmit(event);">
			<h1 id="hNew">New Game</h1>
			<div class="quick-buttons">
				<button type="button" onclick="GW.LifeTracker.onNewQB(40)">40/40</button>
				<button type="button" onclick="GW.LifeTracker.onNewQB(20)">20/20</button>
			</div>
			<div class="input-grid">
				<label>
					<span>Top Player Health:</span>
					<input type="number" name="top" required min="0" max="999" value="40">
				</label>
				<label>
					<span>Bottom Player Health:</span>
					<input type="number" name="bottom" required min="0" max="999" value="40">
				</label>
			</div>
			<footer>
				<button type="submit" autofocus>Start</button>
				<button type="button" onclick="document.getElementById('diaNew').close();">Cancel</button>
			</footer>
		</form>
	</dialog>
	<dialog id="diaInfo" class="info" aria-labelledby="icoInfo">
		<article>
			<gw-icon
				id="icoInfo"
				class="info-icon"
				iconKey="circle-info"
				name="info"
				tabindex="-1"
				role="heading"
				aria-level="1"
				autofocus
			></gw-icon>
			<article>
				<p>
					This life tracker was built for the <a href="https://fabtcg.com/">Flesh and Blood Trading Card Game</a>.
					 It is intended for use on a mobile device.
				</p>
				<figure>
					<a href="https://www.groundedwren.com/" target="_blank">
						<img src="./Img/gw-button.png" alt="Grounded Wren 88x31 Button; white text on a swirling purple, red, and black background">
					</a>
					<figcaption>Created by Vera in 2026</figcaption>
				</figure>
				<p><a class="full" href="https://groundedwren.com/Pages/Projects/index.html">GroundedWren Projects Page</a></p>
			</article>
			<footer>
				<a class="full" href="mailto:vera@groundedwren.com?subject=Life-Tracker">Give feedback</a>
				<button class="default-style" onclick="document.getElementById('diaInfo').close();">Close</button>
			</footer>
		</article>
	</dialog>
	<dialog id="diaHistory" aria-labelledby="hHistory">
		<h1 id="hHistory">History</h1>
		<table>
			<thead>
				<tr>
					<td></td>
					<th scope="col">Top</th>
					<th scope="col">Bottom</th>
				</tr>
			</thead>
			<tbody id="tbodyHistory"></tbody>
		</table>
		<footer>
			<button onclick="document.getElementById('diaHistory').close()">Close</button>
		</footer>
	</dialog>
	<div class="hidden">
		<span id="spnTopPlayerLbl">Top Player</span>
		<span id="spnBottomPlayerLbl">Bottom Player</span>
		<span id="spnAcceptLbl">Accept</span>
	</div>
</body>
</html>